(function(n){if(typeof epi=="undefined"||typeof epi.EPiServer=="undefined"||typeof epi.EPiServer.Forms=="undefined"){console.error("Forms is not initialized correctly");return}if(typeof n=="undefined"){console.error("Forms cannot work without jQuery");return}var t=epi.EPiServer.Forms.Utils,i=epi.EPiServer.Forms.Data,r=epi.EPiServer.Forms.Extension,u=epi.EPiServer.Forms.Validation,f=epi.EPiServer.Forms.Navigation;epi.EPiServer.Forms.__DebounceTimer=null;epi.EPiServer.Forms.__Initialized=!(epi.EPiServer.Forms.__Initialized===undefined);n.extend(!0,epi.EPiServer.Forms,{Utils:{debounce:function(n,t){return function(){var i=this,r=arguments;clearTimeout(this.__DebounceTimer);this.__DebounceTimer=setTimeout(function(){n.apply(i,r)},t)}},loadExternalScriptOnDemand:function(n,t,i){for(var o=document.getElementsByTagName("head")[0],u=0,f=n.length,e=null,r;u<f;u++)e=n[u],r=document.createElement("script"),r.type="text/javascript",r.async=i||!1,r.defer=i||!1,r.src=e,o.appendChild(r),u===f-1&&this._setupCallback(r,t)},loadExternalCssOnDemand:function(n,t){for(var e=document.getElementsByTagName("head")[0],r=0,u=n.length,f=null,i;r<u;r++)f=n[r],i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",f),e.appendChild(i),r===u-1&&this._setupCallback(i,t)},_setupCallback:function(n,t){typeof t=="function"&&(n.onload=t,n.onreadystatechange=function(){this.readyState=="complete"&&t()})},stringFormat:function(n,t){for(var i=n,r=t.length;r--;)i=i.replace(new RegExp("\\{"+r+"\\}","gm"),t[r]||"");return i},getConcatString:function(n,t){return n instanceof Array?n.join(t):n},htmlEncodeEntities:function(t){return n("<div><\/div>").text(t).html()},htmlDecodeEntities:function(n){var t=document.createElement("textarea");return t.innerHTML=n,t.value},isMatchedReg:function(n,t){try{var r=new RegExp(t),i=r.exec(n);return i!=null&&i.length>0}catch(u){return console.debug(u.message),!1}},raiseFormsEvent:function(t,i){var u=n.extend(!0,{type:"forms",workingFormInfo:t},i),r;t?t.$workingForm.triggerHandler(u):(r=n('.EPiServerForms:eq(0), [data-f-type="form"]:first'),(!r||r.length<1)&&(r=n("body")),r.triggerHandler(u))},injectVisitorData:function(t){var r=n(".FormHidden[data-epiforms-visitordatasources], [data-f-visitordatasources]",t.$workingForm),i;r&&r.length!==0&&(i=null,r.each(function(){if(i=n(this),i&&i.length>0){var t=null,r=i.data("epiforms-visitordatasources")||i.data("f-visitordatasources");n(r.split(",")).each(function(n,r){t=epi.EPiServer.Forms.VisitorData[r];typeof t=="function"&&t(i)})}}))},isElementType:function(n,t){return n.data("f-type")===t},getElementName:function(n){return n.attr("name")||n.data("epiforms-element-name")||n.data("f-element-name")},getElementValue:function(i){return i.hasClass("FormFileUpload")||t.isElementType(i,"fileupload")?this.getPreviousPostedFiles(i):i.hasClass("FormChoice")||t.isElementType(i,"choice")?i.find(".FormChoice__Input:checked, [data-f-datainput]:checked").map(function(t,i){return n(i).val()}).get():i.hasClass("FormSelection")||t.isElementType(i,"selection")?[].concat(i.find("select").val()):i.hasClass("FormCaptcha")||i.hasClass("FormTextbox")||i.hasClass("FormTextbox--Textarea")||t.isElementType(i,"captcha")||t.isElementType(i,"textbox")?n.trim(n(".FormTextbox__Input, [data-f-datainput]",i).val()):i.hasClass("FormRange")||t.isElementType(i,"range")?n.trim(n(".FormRange__Input, [data-f-datainput]",i).val()):i.hasClass("Form__CustomElement")||t.isElementType(i,"custom")?epi.EPiServer.Forms.Extension.getCustomElementValue(i):n.trim(i.val())},getFormStepBlock:function(t,i){if(!t)return[];var r=n(".Form__Element [data-epiforms-element-name='"+t+"']",i);return r&&r.length||(r=n("[data-f-type='step'][data-f-element-name='"+t+"']",i)),r},getWorkingFormFromInnerElement:function(t){return formElement=n(t).parents(".EPiServerForms:first, [data-f-type='form']:first")},getFormIdentifier:function(n){return n.prop("id")},getPreviousPostedFiles:function(i){var r=i.find(".FormFileUpload__Input, [data-f-datainput]"),f=t.getElementName(r),e=this.getWorkingFormFromInnerElement(r),o=epi.EPiServer.Forms.Utils.getFormIdentifier(e),s=epi.EPiServer.Forms.Data.loadFormDataFromStorage(o),u=r[0].files;return n.each(s,function(n,t){if(n.indexOf("__TempData")!=-1&&n.replace("__TempData","")==f&&u.length==0)return u=t,!1}),u},getCurrentStepIndex:function(t){var i=n("input[name=__FormCurrentStepIndex]",t.$workingForm).val();return i===undefined||i.trim()===""||isNaN(+i)||+i>t.StepsInfo.Steps.length-1?t.StepsInfo.AllStepsAreNotLinked?i=0:n.each(t.StepsInfo.Steps,function(n,u){if(u.attachedContentLink==epi.EPiServer.CurrentPageLink&&r.isStepSatisfyDependentCondition(u,t))return i=n,!1}):i=+i,i},setCurrentStepIndex:function(t,i){return n("input[name=__FormCurrentStepIndex]",t.$workingForm).val(i),i},validateRegularExpressionValidator:function(n,i,r){if(!r||!r.model||!r.model.jsPattern||i==="")return{isValid:!0};if(!t.isMatchedReg(i,r.model.jsPattern)){var u=t.stringFormat(r.model.message,[r.model.jsPattern,r.description]);return{isValid:!1,message:u}}return{isValid:!0}},showNextStepOnEnterKeyDown:function(t){var i=this.getWorkingFormFromInnerElement(t.target);return(keyCode=t.keyCode,$nextStepButton=n(".Form__NavigationBar .Form__NavigationBar__Action.btnNext, [data-f-type='navigationbar'] [data-f-navigation-next]",i),$buttonSubmitSections=n(".Form__Element.FormSubmitButton, [data-f-type='submitbutton']",i).parent(".FormStep, [data-f-type='step']").filter(function(){return!n(this).hasClass("hide")}),keyCode==13&&$buttonSubmitSections.length==0&&$nextStepButton!=null&&$nextStepButton.length)?(t.preventDefault(),t.stopPropagation(),$nextStepButton.trigger("click"),!0):!0},scrollToTheTopOfForm:function(t){t!=null&&t.css("position").toLowerCase()!=="fixed"&&n(document).scrollTop()>0&&window.scrollTo(0,t.offset().top)}},Extension:{getSummarizedText:function(i,r,u){var h=u?"<br/>":"\n",y=u?i.ConfirmMessage:t.htmlDecodeEntities(i.ConfirmMessage),c=i.ElementsInfo,l=[],a=[],p=["__FormGuid","__FormLanguage","__FormCurrentStepIndex","__FormSubmissionId"],v=i.ConfirmMessage?y+h+h:"",s=null,f=null,e,o;for(e in r)if(l.indexOf(e.replace("__TempData",""))==-1){if(o=e.indexOf("__TempData")!=-1?c[e.replace("__TempData","")]:c[e],s=o&&o.friendlyName?o.friendlyName:"",f=o&&o.customBinding==!0?epi.EPiServer.Forms.CustomBindingElements[o.type](o,r[e]):r[e],(f==null||f instanceof Array&&f.length===0||n.isEmptyObject(f))&&(f=""),f instanceof Array?f=n.map(f,function(n){return n?typeof n=="string"?n:typeof n=="object"?n.name:void 0:null}).join(", "):f instanceof FileList&&f.length==0?f="":(f=f.toString().substr(0,46).trim(),f.length>=45&&(f+=" ...")),n("[name="+e+"]",i.$workingForm).hasClass("FormHideInSummarized")&&a.push(e),s==""||s==null||f==""||f==null||p.indexOf(e)>=0||a.indexOf(e)>=0)continue;else l.push(e);v+=u?t.stringFormat("{0}: {1}"+h,[t.htmlEncodeEntities(s),t.htmlEncodeEntities(f)]):t.stringFormat("{0}: {1}"+h,[t.htmlDecodeEntities(s),f])}return v},showSummarizedText:function(t,i){var r=n.Deferred(),u=this.getSummarizedText(i,t,!1),f;return!u||u.trim()===""?(r.resolve(!0),r.promise()):(f=confirm(u),r.resolve(f),r.promise())},getCustomElementValue:function(n){return n.val()||n.find("[data-f-datainput]").val()},bindCustomElementValue:function(n,t){var i=n.find(".Form__CustomInput, [data-f-datainput]");i.val(t)},resetCustomElementValue:function(n){var t=n.find(".Form__CustomInput, [data-f-datainput]");t.val("")},getAllDataElements:function(t){return n(".Form__Element, .Form__CustomElement, [data-f-type]",t).not(".FormStep,.FormSubmitButton,.Form__Element--NonData,[data-f-type='step'],[data-f-type='form'],[data-f-type='resetbutton'],[data-f-type='submitbutton'],[data-f-element-nondata]")},isStepSatisfyDependentCondition:function(n,t){if(!n)return!1;var r=n.dependField,u=i.loadFormDataFromStorage(t.Id),f=epi.EPiServer.Forms.DependConditions[n.dependCondition];return!r||!f||!u?!0:f(u[r],n.dependValue)},getAntiForgeryToken:function(t){var i=n('input[name="__RequestVerificationToken"]',t.$workingForm).val();return{antiForgeryToken:i}},buildSubmitRequestHeader:function(t){var i={},r=this.getAntiForgeryToken(t);return n.extend(i,r),i}},Data:{loadCurrentFormDataFromStorage:function(n){var t=epi.EPiServer.Forms.Utils.getFormIdentifier(n);return this.loadFormDataFromStorage(t)},loadFormDataFromStorage:function(t){var r=this.getStorage(),i=r[t];return i?(i=n.parseJSON(i),!i)?{}:i:{}},saveCurrentFormDataToStorage:function(n,t){var i=epi.EPiServer.Forms.Utils.getFormIdentifier(n);return this.saveFormDataToStorage(i,t)},saveFormDataToStorage:function(n,t){var i=this.getStorage();try{i.setItem(n,JSON.stringify(t))}catch(r){console.log("Local Storage not supported: "+r.message)}return t},clearFormDataInStorage:function(n){removeFormDataInStorage(epi.EPiServer.Forms.Utils.getFormIdentifier(n))},removeFormDataInStorage:function(n){this.getStorage().removeItem(n)},getStorage:function(){return sessionStorage}},Validation:{getValidatorByValidatorType:function(n,t){if(n instanceof Array&&n.length!==0&&t)for(var r=0,i=null,u=n.length;r<u;r++)if((i=n[r],i)&&i.type===t)return i},getElementValidators:function(n,t){if(n instanceof Array&&n.length!==0&&t)for(var r=0,u=n.length,i=null;r<u;r++)if((i=n[r],i)&&(i.targetElementId===t||i.targetElementName===t))return i.validators},validateFormValue:function(t,i,r){var u=[];return n(r).each(function(r,f){var e=epi.EPiServer.Forms.Validators[f.type],o=null,s;typeof e=="function"?o=e:typeof e.validate=="function"&&(o=e.validate);o&&(s=o(t,i,f),n.extend(s,{fieldName:t,fieldValue:i}),u.push(s))}),u}},Navigation:{findNextStep:function(n,t){var r=null,u=n+1,i=t.StepsInfo.Steps[u];return i&&(r=epi.EPiServer.Forms.Extension.isStepSatisfyDependentCondition(i,t)?i:this.findNextStep(u,t)),r},findPreviousStep:function(n,t){var r=null,u=n-1,i=t.StepsInfo.Steps[u];return i&&(r=epi.EPiServer.Forms.Extension.isStepSatisfyDependentCondition(i,t)?i:this.findPreviousStep(u,t)),r}}});var e=i.getStorage(),o={VisitorData:{"EPiServer.Forms.Implementation.VisitorData.GeoVisitorDataSource":function(t){n.ajax({url:"/EPiServer.Forms/DataSubmit/GetGeoData",type:"GET",success:function(n){var r=t.val(),i;r||(i=t.data("epiforms-visitordataproperty")||t.data("f-visitordataproperty"),n!=null&&n[i]&&t.val(n[i]))}})}}},s={Validators:{"EPiServer.Forms.Implementation.Validation.RequiredValidator":function(n,t,i){return i&&(t==""||t&&!t.length)?{isValid:!1,message:i.model.message}:{isValid:!0}},"EPiServer.Forms.Implementation.Validation.RegularExpressionValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.EmailValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.UrlValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateDDMMYYYYValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateMMDDYYYYValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateYYYYMMDDValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.IntegerValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.PositiveIntegerValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.AllowedExtensionsValidator":function(n,t,i){function h(n,t,i){var r=c(n);return r.length<1?!1:(r=r.toLowerCase(),t.indexOf(r)>=0)?!1:i.length<1?!0:i.indexOf(r)>-1}function c(n){return n.substr((~-n.lastIndexOf(".")>>>0)+2)}if(!t||t instanceof Array&&t.length==0)return{isValid:!0};var o=t,r=i.model.accept,l=epi.EPiServer.Forms.UploadExtensionBlackList.split(","),u=r==undefined||r.length<1?[]:r.split(","),f=0,e=0,s=u.length,a=o.length;if(s>0)for(;f<s;f++)u[f]=u[f].substr(1);for(;e<a;e++)if(!h(o[e].name,l,u))return{isValid:!1,message:epi.EPiServer.Forms.Utils.stringFormat(i.model.message,[r])};return{isValid:!0}},"EPiServer.Forms.Implementation.Validation.MaxFileSizeValidator":function(n,t,i){for(var u=t,r=0,e=u.length,f=i.model.sizeInBytes;r<e;r++)if(u[r].size>f)return{isValid:!1,message:epi.EPiServer.Forms.Utils.stringFormat(i.model.message,[f/1048576])};return{isValid:!0}},"EPiServer.Forms.Implementation.Validation.NumericValidator":function(t,i,r){return!i||n.isNumeric(i)==!0?{isValid:!0}:{isValid:!1,message:r.model.message}},"EPiServer.Forms.Implementation.Validation.CaptchaValidator":{initialize:function(t){var i=this;t.parents(".FormCaptcha, [data-f-type='captcha']").find(".FormCaptcha__Refresh, [data-f-captcha-refresh]").on("click",function(t){i._refreshCaptcha(n(this));t.preventDefault()})},validate:function(n,t){var i=t.trim();return i!=null&&i!=""},onServerValidateFailed:function(n){this._refreshCaptcha(n);n.focus()},_refreshCaptcha:function(n){var i=n.hasClass("FormCaptcha")||t.isElementType(n,"captcha")?n:n.parents(".FormCaptcha, [data-f-type='captcha']"),r=i.find(".FormCaptcha__Image, [data-f-captcha-image]"),u=i.find(".FormTextbox__Input, [data-f-datainput]");r.attr("src",r.attr("src")+"&d="+Math.random());u.val("")}}}},h={DependConditions:{Equals:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,",").toUpperCase():"",t=t?t.toUpperCase():"",n===t},NotEquals:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,",").toUpperCase():"",t=t?t.toUpperCase():"",n!=t},Contains:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,",").toUpperCase():"",t=t?t.toUpperCase():"",n.indexOf(t)>=0},NotContains:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,","):"",!n&&t||n&&!t||n&&t&&n.toUpperCase().indexOf(t.toUpperCase())<0},MatchRegularExpression:function(n,t){var i=new RegExp(t,"igm");return i.ignoreCase=i.global=i.multiline=!0,!t||t&&i.test(n)}}};n.extend(!0,epi.EPiServer.Forms,o);n.extend(!0,epi.EPiServer.Forms,s);n.extend(!0,epi.EPiServer.Forms,h);n.extend(!0,epi.EPiServer.Forms,{CustomBindingElements:{}});epi.EPiServer.Forms.init=function(){epi.EPiServer.Forms.__Initialized||(epi.EPiServer.Forms.__Initialized=!0,n(document).ready(function(){function y(i){var f,r,e,h;if(i.preventDefault(),i.stopPropagation(),f=t.getWorkingFormFromInnerElement(i.target),r=s(f),r.SubmittableStatus.submittable===!1)return o(r,r.SubmittableStatus.message),!1;if(e=l(r),!nt(e,r))return c(e),tt(e),!1;h=et(f);n.when(ut(r,h)).then(function(e){var c,l,s,v,a,y;if(!e)return!1;c=[];l=null;for(s in h)s.indexOf("__TempData")==-1&&(l=t.getFormStepBlock(s,f),l.parents(".FormStep:first, [data-f-type='step']:first").hasClass("hide")||(v=u.getElementValidators(r.ValidationInfo,s),c=c.concat(u.validateFormValue(s,h[s],v))));if(a=n.grep(c,function(n){return n.isValid==!1}),a.length>0)return y=n.map(a,function(n){return r.ElementsInfo[n.fieldName].friendlyName+": "+n.message}),o(r,y.join(" ")),!1;b(i)})}function p(n){n.preventDefault();n.stopPropagation();var r=t.getWorkingFormFromInnerElement(n.target),i=s(r);t.raiseFormsEvent(i,{type:"formsReset",sourceEvent:n});w(r,i);h(i.StepsInfo.Steps[0],i)}function w(u,f){u.get(0).reset();f.SubmittableStatus&&f.SubmittableStatus.submittable===!1?o(f,f.SubmittableStatus.message):o(f,"");i.removeFormDataInStorage(f.Id);r.getAllDataElements(u).each(function(i,u){var f=n(u);a(f).text("");f.hasClass("FormChoice")||t.isElementType(f,"choice")?f.find("input[type=checkbox], input[type=radio]").each(function(t,i){var r=n(i);r.prop("checked",r.data("epiforms-default-value")||r.data("f-default-value")?!0:!1)}):f.hasClass("FormSelection")||t.isElementType(f,"selection")?(f.find("option[disabled]:eq(0)").prop("selected",!0),f.find("option").each(function(t,i){var r=n(i);r.prop("disabled")===!1&&r.prop("selected",r.data("epiforms-default-value")||r.data("f-default-value")?!0:!1)})):f.hasClass("FormFileUpload")||t.isElementType(f,"fileupload")?(k(f).text(""),it(f.find(".FormFileUpload__Input, [data-f-datainput]"))):(f.hasClass("Form__CustomElement")||t.isElementType(f,"custom"))&&r.resetCustomElementValue(f)})}function b(u){var p=t.getWorkingFormFromInnerElement(u.target),ht=epi.EPiServer.Forms.Utils.getFormIdentifier(p),e=s(p),nt=i.saveFormDataToStorage(e.Id,d(p)),c=new FormData,ut=t.getCurrentStepIndex(e),tt=f.findNextStep(ut,e),k=tt?!1:!0,y=n(u.srcElement||u.target),st=!!y.data("epiforms-is-progressive-submit")||!!y.data("f-is-progressive-submit"),a,b,ft,et,ot,g;k=k||!!y.data("epiforms-is-finalized")||!!y.data("f-is-finalized");nt[y.prop("name")]=y.val();c.append("__FormGuid",ht);c.append("__FormHostedPage",epi.EPiServer.CurrentPageLink);c.append("__FormLanguage",epi.EPiServer.CurrentPageLanguage);c.append("__FormCurrentStepIndex",ut);c.append("__FormWithJavaScriptSupport","true");for(b in nt)if(nt.hasOwnProperty(b))if(a=nt[b],Array.isArray(a)&&a.length>0&&a[0]!==null&&typeof a[0]=="object"&&a[0].file&&Object.getPrototypeOf(a[0].file)===File.prototype){for(ft=a,et="",g=0;g<ft.length;g++)ot=ft[g].file,c.append(b+"_file_"+g,ot),et+=ot.name+"|";c.append(b,et)}else c.append(b,a);t.raiseFormsEvent(e,{type:"formsStartSubmitting",formData:c});y.prop("disabled",!0);o(e,"");n.ajax({url:e.DataSubmitController+"/Submit",headers:r.buildSubmitRequestHeader(e),data:c,cache:!1,type:p.prop("method"),processData:!1,contentType:!1,async:epi.EPiServer.Forms.AsyncSubmit||p.data("epiforms-async-submit")||p.data("f-async-submit")||!1,success:function(r){var s,a,y,f;if(u.preventDefault(),n(".Form__Element__ValidationError, [data-f-validationerror]").text(""),r.IsSuccess===!0){if(s=l(e),n(".FormFileUpload .FormFileUpload__Input, [data-f-type='fileupload'] [data-f-datainput]",s).each(function(){n(this).val("");it(n(this))}),k==!1&&st==!1)return t.raiseFormsEvent(e,{type:"formsNavigationNextStep",targetStep:tt}),a=i.loadFormDataFromStorage(e.Id),y=n.extend(a,{__FormSubmissionId:r.Data.SubmissionId}),i.saveFormDataToStorage(e.Id,y),t.raiseFormsEvent(e,{type:"formsSubmitted",formData:c,isFinalizedSubmission:!1,isSuccess:r.IsSuccess,returnedResult:r}),h(tt,e),!1;if(k==!0&&w(p,e),t.raiseFormsEvent(e,{type:"formsSubmitted",formData:c,isFinalizedSubmission:k,isSuccess:r.IsSuccess,returnedResult:r}),f=e.StepsInfo.Steps.length,r.RedirectUrl)return window.location.href=r.RedirectUrl,!1;st==!1&&!tt&&ut<f-1?h(e.StepsInfo.Steps[f-1],e):(n(".Form__MainBody, [data-f-mainbody]",e.$workingForm).hide(),o(e,r.Message,!0))}else v(e),t.raiseFormsEvent(e,{type:"formsSubmitted",formData:c,isSuccess:r.IsSuccess,returnedResult:r}),r.Message&&o(e,r.Message),r.Data&&r.Data.ValidationInfo&&r.Data.ValidationInfo.length>0&&rt(e,r.Data.ValidationInfo)},error:function(n,i,r){u.preventDefault();t.raiseFormsEvent(e,{type:"formsSubmittedError",formData:c,isSuccess:!1,returnedResult:returnedResult,xhr:n,typeOfFailure:i,status:r});o(e,i+" "+n.status+": "+r)},complete:function(){y.prop("disabled",!1);v(e)}})}function rt(t,i){for(var s,e,f=null,r=0;r<i.length;r++)if(i[r]&&i[r].InvalidElement){f=n("#"+i[r].InvalidElement+"",t.$workingForm);var h=a(f),l=u.getElementValidators(t.ValidationInfo,i[r].InvalidElement),o=u.getValidatorByValidatorType(l,i[r].Validator);o&&(s=epi.EPiServer.Forms.Validators[o.type],e=s.onServerValidateFailed,e&&typeof e=="function"&&e.apply(s,[f,o]));h.text(i[r].ValidationMessage||epi.EPiServer.Forms.Messages.viewMode.commonValidationFail).show()}f&&c(f.parents(".FormStep:first, [data-f-type='step']:first"))}function ut(t,i){var u=n.Deferred(),f,e;return t.ShowSummarizedData?(f=[],e=["__FormGuid","__FormLanguage","__FormCurrentStepIndex","__FormSubmissionId"],r.showSummarizedText(i,t,e,f)):(u.resolve(!0),u.promise())}function o(t,i,r){if(t){var u=n(".Form__Status__Message, [data-f-form-statusmessage]",t.$workingForm);u.removeClass("Form__Warning__Message").removeClass("Form__Success__Message");r==!0&&i?u.removeClass("hide").addClass("Form__Success__Message").html(i):i?u.removeClass("hide").addClass("Form__Warning__Message").html(i):u.addClass("hide").html("")}}function ft(i,u){n.each(i,function(i,f){var h=i.indexOf("__TempData")!=-1?i.replace("__TempData",""):i,e=n('[data-epiforms-element-name="'+h+'"], [data-f-element-name="'+h+'"]',u),o,c,s,l,a,v;if(e.length!=0){if(e.hasClass("FormExcludeDataRebind")||!!e.data("f-excludedatarebind"))return;if(o=e.find(".FormChoice__Input--Checkbox, [data-f-datainput]:checkbox"),o.length!=0){n.each(o,function(){var t=n(this).val();n(this).attr("checked",f.indexOf(t)>-1)});return}if(o=e.find(".FormChoice__Input--Radio, [data-f-datainput]:radio"),o.length!=0){c=n.isArray(f)?f[0]:f;n.each(o,function(){var t=n(this).val();n(this).attr("checked",c==t)});return}if(e.hasClass("FormSelection")||t.isElementType(e,"selection")){n("option:enabled",e).each(function(t,i){n(i).attr("selected",f.indexOf(n(i).val())>-1)});return}if(e.hasClass("FormCaptcha")||t.isElementType(e,"captcha"))return;if(o=e.find(".FormFileUpload__Input, [data-f-datainput]:file"),o.length!=0){s="";f instanceof Array&&f.length>0&&(l=f.map(function(n){return n.name}).join(", "),s=s.concat(l));s!==""&&(a=t.stringFormat(epi.EPiServer.Forms.Messages.fileUpload.postedFile,[s]),v=k(e),v.text(a).show());return}if(e.hasClass("Form__CustomElement")||t.isElementType(e,"custom")){r.bindCustomElementValue(e,f);return}e.find("[data-f-datainput]:first").val(f)}})}function k(n){return n.find(".FormFileUpload__PostedFile, [data-f-postedFile]")}function d(t,r){var u=s(t),f=l(u),e=g(f,r),o=i.loadFormDataFromStorage(u.Id);return n.extend(o,e)}function et(t){var r=s(t),u=g(t),f=i.loadFormDataFromStorage(r.Id);return n.extend(f,u)}function s(n){var r=t.getFormIdentifier(n),i=epi.EPiServer.Forms[r];return i.$workingForm=n,i}function g(i,u){var f={};return r.getAllDataElements(i).each(function(i,r){var e,o,s,l,h,c;if(($el=n(r),typeof u!="function"||!u($el))&&!$el.parents(".FormStep:first, [data-f-type='step']:first").hasClass("hide")&&(e=t.getElementName($el),e)){if($el.hasClass("FormFileUpload")||t.isElementType($el,"fileupload")){if(o=n(".FormFileUpload__Input, [data-f-datainput]",$el)[0],s=e+"__TempData",f[e]=[],f[s]=[],o&&o.files.length!==0)for(h=0;h<o.files.length;h++)c=o.files[h],f[e].push({name:c.name,file:c}),f[s].push({name:c.name});else l=t.getPreviousPostedFiles($el),f[e]=l,f[s]=l;return}f[e]=t.getElementValue($el)}}),f}function nt(n,i){if(!n)return!0;var u=!0;return r.getAllDataElements(n).each(function(n,t){u=ot(t,i)&&u}),t.raiseFormsEvent(i,{type:"formsStepValidating",isValid:u}),i.$workingForm.toggleClass("ValidationSuccess",u),i.$workingForm.toggleClass("ValidationFail",!u),u}function ot(i,r){var f=n(i),s=a(f),h=t.getElementName(f),v=f.attr("id")||h,c=u.getElementValidators(r.ValidationInfo,v),e=!0,l,y,o,p;return f.removeClass("ValidationFail ValidationSuccess"),s.hide(),l=t.getElementValue(f),c instanceof Array&&c.length>0&&(y=u.validateFormValue(h,l,c),o=n.grep(y,function(n){return n.isValid==!1}),o&&o.length>0?(p=n.map(o,function(n){return n.message}),f.addClass("ValidationFail"),s.text(p.join(" ")).show(),e=!1):(f.addClass("ValidationSuccess"),e=!0)),t.raiseFormsEvent(r,{type:"elementValidated",isValid:e,elementName:h,elementValue:l,elementIdentifier:v,element:i,$messageContainer:s}),e}function a(i){var r=t.getElementName(i),u=t.stringFormat("{0}[data-epiforms-linked-name='{1}'], {0}[data-epiforms-linked-name='{2}']",[".Form__Element__ValidationError",r,i.attr("id")]),f=t.stringFormat("{0}[data-f-linked-name='{1}'], {0}[data-f-linked-name='{2}']",["[data-f-validationerror]",r,i.attr("id")]);return n(u).add(f)}function st(r){if(r&&r.StepsInfo&&r.StepsInfo.Steps&&(r.$steps=n(".FormStep, [data-f-type='step']",r.$workingForm),!(r.StepsInfo.Steps.length<2))){var u=r.StepsInfo.Steps[t.getCurrentStepIndex(r)];h(u,r);n(".Form__NavigationBar__Action.btnNext, [data-f-navigation-next]",r.$workingForm).on("click",function(n){n.preventDefault();var t=l(r),i=nt(t,r);if(!i)return c(t),tt(t),!1;b(n)});n(".Form__NavigationBar__Action.btnPrev, [data-f-navigation-previous]",r.$workingForm).on("click",function(u){var o,e,s;u.preventDefault();o=d(r.$workingForm,function(n){return n.hasClass("FormFileUpload")||t.isElementType(n,"fileupload")});i.saveFormDataToStorage(r.Id,o);e=f.findPreviousStep(t.getCurrentStepIndex(r),r);h(e,r);s=n("section[data-epiforms-stepindex="+e.index+"], section[data-f-stepindex="+e.index+"]",r.$workingForm);c(s);t.raiseFormsEvent(r,{type:"formsNavigationPrevStep",targetStep:e})})}}function h(r,u){if(r){t.raiseFormsEvent(u,{type:"formsNavigateToStep",targetStep:r});var f=i.loadFormDataFromStorage(u.Id);if(ft(f,u.$workingForm),u.StepsInfo.AllStepsAreNotLinked||r.attachedContentLink==epi.EPiServer.CurrentPageLink)u.$steps.addClass("hide"),u.$steps.each(function(i,f){if(i===r.index)return n(f).removeClass("hide"),t.setCurrentStepIndex(u,r.index),!1}),t.scrollToTheTopOfForm(u.$workingForm);else{if(r.attachedUrl&&r.attachedUrl.length){window.location.replace(r.attachedUrl);return}u.StepsInfo.AllStepsAreNotLinked||o(u,epi.EPiServer.Forms.Messages.viewMode.malformStepConfiguration)}}else u.$steps.hide();v(u)}function c(t){epi.EPiServer.Forms.Validators["EPiServer.Forms.Implementation.Validation.CaptchaValidator"]._refreshCaptcha(n(".Form__Element.FormCaptcha, [data-f-type='captcha']",t))}function tt(t){if(t){var i=n(".Form__Element.ValidationFail",t)[0];i&&(i.scrollIntoView(),n("[data-f-datainput]",i).focus())}}function v(i){var u=t.getCurrentStepIndex(i),r=n(".Form__NavigationBar, [data-f-type='navigationbar']",i.$workingForm),o,s,f,e;if(u<0){r.hide();return}o=n(".Form__NavigationBar__Action.btnPrev, [data-f-navigation-previous]",r).prop("disabled",!1);s=n(".Form__NavigationBar__Action.btnNext, [data-f-navigation-next]",r).prop("disabled",!1);(u==0||i.SubmittableStatus.submittable===!1)&&o.prop("disabled",!0);(u==i.StepsInfo.Steps.length-1||i.SubmittableStatus.submittable===!1)&&s.prop("disabled",!0);n(".Form__NavigationBar, [data-f-type='navigationbar']",i.$workingForm).toggle(i.ShowNavigationBar);f=u+1;e=i.StepsInfo.Steps.length;n(".Form__NavigationBar__ProgressBar__CurrentStep, [data-f-navigation-currentStep]",r).text(f);n(".Form__NavigationBar__ProgressBar__StepsCount, [data-f-navigation-stepcount]",r).text(e);n(".Form__NavigationBar__ProgressBar--Progress, [data-f-navigation-progress]",r).css({width:100*f/e+"%"})}function l(i){var r=t.getCurrentStepIndex(i);return n(i.$steps[r])}function it(n){/MSIE/.test(navigator.userAgent)&&n.replaceWith(n=n.clone(!0))}if(!e){n('.EPiServerForms .Form__Status__Message, [data-f-type="form"] [data-f-form-statusmessage]').text(epi.EPiServer.Forms.ErrorMessages.cantnotworkwithoutstorage);return}n('.EPiServerForms, [data-f-type="form"]').each(function(i,r){var f=n(r),u=s(f);u.SubmittableStatus&&u.SubmittableStatus.submittable===!1&&o(u,u.SubmittableStatus.message);st(u);n(u.ValidationInfo).each(function(t,i){n(i.validators).each(function(t,r){var u=epi.EPiServer.Forms.Validators[r.type];u&&typeof u.initialize=="function"&&u.initialize(n("#"+i.targetElementId))})});t.injectVisitorData(u);n(".Form__Element.FormSubmitButton, [data-f-type='submitbutton']",f).off("click",y).on("click",y);n(".Form__Element.FormResetButton, [data-f-type='resetbutton']",f).off("click",p).on("click",p);t.raiseFormsEvent(u,{type:"formsSetupCompleted"})});n(".EPiServerForms .FormTextbox--Number .FormTextbox__Input, [data-f-type='form'][data-f-type='textbox'][data-f-modifier='number'] [data-f-datainput]").on("keydown",function(n){var t=n.which||n.keyCode,i;return!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t>=65&&t<=90||t==32?!1:!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t>=48&&t<=57||t>=96&&t<=105||n.keyCode==65&&n.ctrlKey===!0||t==67&&n.ctrlKey===!0||t==88&&n.ctrlKey===!0||t>=35&&t<=39||t==8||t==9||t==13||t==46||t==45?!0:(i=this.value,(t==109||t==189)&&i[0]==="-")?!1:(!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t==190||t==188||t==110)&&/[\.,]/.test(i)?!1:void 0}).on("keyup",function(){var n=this.value;+n||n&&(n=(n[0]==="-"?"-":"")+n.replace(/[^0-9\.]/g,""),n=n.replace(/\.(?=(.*)\.)+/g,""),this.value=n)});n('.EPiServerForms input.FormTextbox__Input,.FormChoice__Input.FormChoice__Input--Checkbox,.FormRange__Input,.FormTextbox__Input.FormUrl__Input,.FormChoice__Input.FormChoice__Input--Radio,.FormTextbox__Input.FormCaptcha__Input.FormHideInSummarized,[data-f-type="form"] [data-f-datainput]:not(textarea)').on("keydown",function(n){return t.showNextStepOnEnterKeyDown(n)})}))};epi.EPiServer.Forms.ExternalScriptSources.length<=0&&epi.EPiServer.Forms.ExternalCssSources.length<=0?epi.EPiServer.Forms.init():(t.loadExternalScriptOnDemand(epi.EPiServer.Forms.ExternalScriptSources,function(){t.raiseFormsEvent(null,{type:"formsLoadExternalScripts",scripts:epi.EPiServer.Forms.ExternalScriptSources});epi.EPiServer.Forms.init()}),t.loadExternalCssOnDemand(epi.EPiServer.Forms.ExternalCssSources,function(){t.raiseFormsEvent(null,{type:"formsLoadExternalCss",Css:epi.EPiServer.Forms.ExternalCssSources})}))})($$epiforms||$);